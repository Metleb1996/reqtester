<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/json.min.js"></script>
  <script>hljs.highlightAll();</script>
  <title>Request Tester</title>
</head>

<body>
  <header>
    <!---->
  </header>
  <main>
    <div class="m-3">
      <div class="row">
        <div class="col-12">
          <div class="m-4 my-0">
            <div>
              <!-- <button type="button" class="btn btn-info btn-sm my-1"><i class="bi bi-folder me-2"></i>Load</button>
                <button type="button" class="btn btn-info btn-sm my-1"><i class="bi bi-download me-2"></i>Save</button>
                <button type="button" class="btn btn-info btn-sm my-1"><i class="bi bi-save me-2"></i>Save As</button> -->
              <div class="w-auto mt-3">
                <div class="input-group mb-3">
                  <input type="url" class="form-control" id="sburlinpt" placeholder="Base URL address"
                    aria-label="Base URL address" aria-describedby="sburlbtn">
                  <button class="btn btn-outline-secondary" type="button" id="sburlbtn">Set Base URL</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12">
          <div class="row mb-5">
            <div class="col-md-12">
              <div class="m-3">
                <div class="row m-1">
                  <div class="text-center m-3 mt-1">Request</div>
                  <div class="col-sm-2 p-1">
                    <select class="form-select form-select-sm" id="req_method" aria-label="Select request method">
                      <option selected value="get">GET</option>
                      <option value="post">POST</option>
                      <option value="put">PUT</option>
                      <option value="patch">PATCH</option>
                      <option value="delete">DELETE</option>
                    </select>
                  </div>
                  <div class="col-sm-8 p-1">
                    <div class="input-group input-group-sm">
                      <span class="input-group-text" id="requrlbase"></span>
                      <input type="text" class="form-control" id="req_url" aria-describedby="requrlbase">
                    </div>
                  </div>
                  <div class="col-sm-2 p-1">
                    <div>
                      <button type="button" class="btn btn-info" id="req_send">Send</button>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <p class="m-1">
                      <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                        data-bs-target="#req_headers" aria-expanded="false" aria-controls="req_headers">Headers</button>
                      <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#req_data"
                        aria-expanded="false" aria-controls="req_data">Data</button>
                    </p>
                    <div class="row">
                      <div class="col-12 col-md-6">
                        <div class="collapse multi-collapse" id="req_headers">
                          <div class="card card-body">
                            <div class="p-1 bg-light">
                              <div class="overflow-auto m-0" style="min-height: 200px">
                                <div class="row">
                                  <div id="req_h">
                                    <div class="col-12">
                                      <form class="border mb-1 m-0">
                                        <div class="m-1">
                                          <input type="text" class="form-control" id="hkey0" placeholder="key">
                                        </div>
                                        <div class="m-1">
                                          <input type="text" class="form-control" id="hval0" placeholder="value">
                                        </div>
                                      </form>
                                    </div>
                                  </div>
                                  <div class="col-12">
                                    <div class="m-1">
                                      <button type="button" onclick="addForm('h')" class="btn btn-primary">Add<i
                                          class="ms-1 bi bi-plus-square"></i></button>
                                    </div>
                                    <div class="m-1">
                                      <button type="button" onclick="submitForm('h')" class="btn btn-primary">Submit<i
                                          class="ms-1 bi bi-plus-square"></i></button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 col-md-6">
                        <div class="collapse multi-collapse" id="req_data">
                          <div class="card card-body">
                            <div class="p-1 bg-light">
                              <div class="overflow-auto m-0" style="min-height: 200px">
                                <div class="row">
                                  <div id="req_d">
                                    <div class="col-12">
                                      <form class="border mb-1 m-0">
                                        <div class="m-1">
                                          <input type="text" class="form-control" id="dkey0" placeholder="key">
                                        </div>
                                        <div class="m-1">
                                          <input type="text" class="form-control" id="dval0" placeholder="value">
                                        </div>
                                      </form>
                                    </div>
                                  </div>
                                  <div class="col-12">
                                    <div class="m-1">
                                      <button type="button" onclick="addForm('d')" class="btn btn-primary">Add<i
                                          class="ms-1 bi bi-plus-square"></i></button>
                                    </div>
                                    <div class="m-1">
                                      <button type="button" onclick="submitForm('d')" class="btn btn-primary">Submit<i
                                          class="ms-1 bi bi-plus-square"></i></button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <hr>
                <div class="row">
                  <div class="text-center m-3 mt-1">Response</div>
                  <div class="mx-3 my-1 text-info"><span id="res_scode"></span> <span id="res_stext"></span></div>
                  <div class="col-12">
                    <p class="m-1">
                      <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
                        data-bs-target="#res_headers" aria-expanded="false" aria-controls="res_headers">Headers</button>
                      <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#res_data"
                        aria-expanded="false" aria-controls="res_data">Data</button>
                    </p>
                    <div class="row">
                      <div class="col-12 col-md-6">
                        <div class="collapse multi-collapse" id="res_headers">
                          <div class="card card-body">
                            <div class="p-1 bg-light">
                              <pre class="language-json overflow-auto" id="res_h" style="height: 200px"></pre>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 col-md-6">
                        <div class="collapse multi-collapse" id="res_data">
                          <div class="card card-body">
                            <div class="p-1 bg-light">
                              <pre class="language-json overflow-auto" id="res_b" style="height: 200px"></pre>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer class="fixed-bottom">
    <!-- Copyright -->
    <div class="text-center m-3 bg-light">
      © 2022 Copyright:
      <a class="text-dark" href="/">Metleb RUSTEMOV</a>
    </div>
    <!-- Copyright -->
  </footer>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    let config = {
      color_class: {
        get: "bg-info",
        post: "bg-success",
        put: "bg-warning",
        patch: "bg-primary",
        delete: "bg-danger",
      }
    };
    let reqData = {};
    let reqHeader = {};
    //let proxyServer = "https://cors-anywhere.herokuapp.com/";
    let proxyServer = "";
    let baseUrl = '';
    let hCount = 1;
    let dCount = 1;
    function submitForm(tp){
      if(tp == 'h'){
        for(let i = 0; i<hCount; i++){
          key = document.getElementById(tp+'key'+i).value;
          val = document.getElementById(tp+'val'+i).value;
          reqHeader[key] = val; 
        }
      }
      if(tp == 'd'){
        for(let i = 0; i<dCount; i++){
          key = document.getElementById(tp+'key'+i).value;
          val = document.getElementById(tp+'val'+i).value;
          reqData[key] = val;
        }
      }
      console.log(reqData, reqHeader);
    }
    function addForm(tp) {
      let template = ["<form class=\"border mb-1 m-0\"><div class=\"m-1\"><input type=\"text\" class=\"form-control\" id=\"","key","\" placeholder=\"key\"></div><div class=\"m-1\"><input type=\"text\" class=\"form-control\" id=\"","val","\" placeholder=\"value\"></div></form>"];
      let newElement = document.createElement('div');
      newElement.classList.add('col-12');
      if (tp == 'h'){
        let str = template[0]+tp+template[1]+hCount+template[2]+tp+template[3]+hCount+template[4];
        newElement.innerHTML = str.trim();
        hCount += 1;
      }
      if (tp == 'd'){
        let str = template[0]+tp+template[1]+dCount+template[2]+tp+template[3]+dCount+template[4];
        newElement.innerHTML = str.trim();
        dCount += 1;
      }
      document.getElementById('req_'+tp).appendChild(newElement);
    };
    document.getElementById('sburlbtn').onclick = function () {
      let baseUrlInput = document.getElementById('sburlinpt');
      document.getElementById('requrlbase').innerText = baseUrlInput.value;
      baseUrl = baseUrlInput.value;
    };
    document.getElementById('req_send').onclick = async function () {
      let method = document.getElementById('req_method').value; 
      let url = proxyServer + baseUrl + document.getElementById('req_url').value;
      let respo;
      if (url === '') {
        alert('URL cannot be empty.');
      }
      else {
        await axios({
          method,
          url,
          data: reqData,
        })
          .then(response => {
            respo = response;
            console.log(response);
          })
          .catch(error => {
            if (error.response) {
              respo = error.response;
            } else if (error.request) {
              console.log(error.request);
            } else {
              console.log('Error', error.message);
            }
          });
        if (respo != null) {
          document.getElementById('res_scode').innerText = respo.status;
          document.getElementById('res_stext').innerText = respo.statusText;
          document.getElementById('res_h').innerHTML = hljs.highlight(JSON.stringify(respo.headers, null, '\t'), { language: 'json' }).value;
          document.getElementById('res_b').innerHTML = hljs.highlight(JSON.stringify(respo.data, null, '\t'), { language: 'json' }).value;
        }
      }
    }
  </script>
</body>

</html>